--//AULA DO DIA 06.04

--EXERCICIO

/*	CRIAR UMA STORED PROCEDURE QUE EXCLUA UM CLIENTE. PASSAR O CODIGO DO CLIENTE COMO PRAMETRO
	VERIFICAR SE O CLIENTE EXSITE: SE EXISITIR, EXIBIR
	"CLIENTE EXCLUIDO COM SUCESSO"; SE NAO EXISTIR EXIBIR "CLIENTE INVALIDO!".
*/

--RESPOSTA
	CREATE OR REPLACE PROCEDURE P_EXCLUI_CLI (PCODCLI NUMBER)
	AS
		BEGIN
			DELETE FROM CLIENTE
			WHERE COD_CLIENTE = PCODCLI;
			
			IF SQL%ROWCOUNT = 0 THEN
				--INSERT INTO TAB_ERRO VALUES(SYSDATE, 'CLIENTE INVALIDO');
				RAISE_APPLICATION_ERROR(-20001,'CLIENTE INVALIDO');
			ELSE
				INSERT INTO TAB_ERRO VALUES (SYSDATE, 'CLIENTE EXCLUIDO COM SUCESSO');
			END IF
			COMMIT;
		 END;

--EXPLICAÇÃO DO SQL%ROWCOUNT E RAISE_APPLICATION_ERROR
	
	SQL%ROWCOUNT É UMA VARIAVEL USADA PELO ORACLE PARA INDICAR O NUMERO DE LINHAS RETORNADAS PELO ULTIMO COMANDO
	SQL EFETUADO ANTERIORMENTE, UTIL PARA DELETAR E FAZER UPDATES, POIS ESTES COMANDOS NAO ENTRAM NA EXCEÇÃO NO_DATA_FOUND QUANDO
	DEVOLVEM 0 LINHAS.

	RAISE_APPLICATION_ERROR´É UMA FUNÇÃO PRE DEFINIDA PELO ORACLE PARA TRATAR MENSAGENS DE ERRO SE O ERRO ACONTECER
	O RAISE FORÇA O ROLLBACK (DESFAZ A AÇÃO).